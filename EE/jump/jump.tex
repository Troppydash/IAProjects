\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper,margin=1in,footskip=0.25in]{geometry}

% science
\usepackage{amsmath}
\usepackage{array}
\usepackage{siunitx}
\usepackage{amssymb}

% code
% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{10} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{10}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

\usepackage{listings}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
        language=Python,
        basicstyle=\ttm,
        morekeywords={self},              % Add keywords here
        keywordstyle=\ttb\color{deepblue},
        emph={MyClass,__init__},          % Custom highlighting
        emphstyle=\ttb\color{deepred},    % Custom highlighting style
        stringstyle=\color{deepgreen},
        frame=tb,                         % Any extra options here
        showstringspaces=false
}}

\newcommand\pythonstyleln{\lstset{
        language=Python,
        basicstyle=\ttm,
        morekeywords={self},              % Add keywords here
        keywordstyle=\ttb\color{deepblue},
        emph={MyClass,__init__},          % Custom highlighting
        emphstyle=\ttb\color{deepred},    % Custom highlighting style
        stringstyle=\color{deepgreen},
        frame=tb,                         % Any extra options here
        showstringspaces=false,
        numbers=left
}}

% Python environment
\lstnewenvironment{python}[1][]
{
    \pythonstyle
    \lstset{#1}
}
{}

\lstnewenvironment{pythonln}[1][]
{
    \pythonstyleln
    \lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
        \pythonstyle
        \lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}

% layout
\usepackage{float}
\usepackage{parskip}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{hyperref}
\usepackage[export]{adjustbox}
\usepackage{hhline}
\usepackage{chngcntr}

% referencing
\usepackage[style=apa]{biblatex}
\addbibresource{jump.bib}

% table centering
\renewcommand{\arraystretch}{1.3}
\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcommand{\tptt}{$\times\,$}

% figures labelings
\usepackage{chngcntr}
\counterwithin{figure}{section}

\usepackage{caption}
\usepackage{subcaption}
\usepackage{wrapfig}

% fancy page numbers
\usepackage{fancyhdr}
% bottom right
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[R]{\thepage}
\fancypagestyle{plain}{%
    \renewcommand{\headrulewidth}{0pt}%
    \fancyhf{}%
    \fancyfoot[R]{\thepage}%
}
%go
\renewcommand{\headrulewidth}{0pt}

% extra maths commands
\usepackage{mathtools}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\newcommand{\tvec}[1]{\boldsymbol{#1}}
\newcommand{\tunit}[1]{\boldsymbol{\hat{#1}}}
\newcommand{\tmag}[1]{\|#1\|}
\newcommand{\tang}[1]{\left\langle #1 \right\rangle}
\newcommand{\td}{\tvec{d}}
\newcommand{\ta}{\tvec{a}}
\newcommand{\tv}{\tvec{v}}
\newcommand{\tp}{\tvec{p}}
\newcommand{\tpar}[2]{\begin{bmatrix}#1\\#2 \end{bmatrix}}
\newcommand{\tpars}[3]{\begin{bmatrix} #1\\#2\\#3 \end{bmatrix}}
\newcommand{\tfx}{\mathcal{X}}
\newcommand{\tfy}{\mathcal{Y}}

\newcommand{\I}{{i\mkern1mu}}

\linespread{1.5}

\usepackage{hyperref}

\title{The Optimization of Air Movements within a Video Game Jump Action}

\author{Word Count: $<$ 4000}
\date{}

%\includeonly{
    %sections/jumping.tex,
 %   sections/models.tex
%}
\begin{document}

    \maketitle

    \newpage
    % texcount

    \newpage

    \tableofcontents

    \newpage


% introduction
%  research question
%  reasons
%  definitions

% mechanics
%  vectors and quirk dot product
%  complex numbers and differential equation

% Z-axis modelling
%  continous updating
%  discrete updating
%  evaluation

% XY-axis modelling
%  continous straightline
%  continous right turning at fixed rate
%  continous euler-lagrange
%  discrete velocity maximizing
%  discrete velocity maximizing with let go
%  discrete displacement maximizing
%  result, significance

% Conclusion


% first model and my best attempt



\input{sections/introduction.tex}

\section{Basic Models}
I want to set some baseline movement models in this section, for it not only helps me to visualize the problem, but can also test my conjuncture in the negligibility of the continuous approximations.

My approach to maximize player jumping displacement can be described in sections. Firstly, I wish to find an optimal starting condition, then an analogy can made with projectile motion, leading to the precalculation of the vertical motion; Secondly, I hope to model the mechanics between the remaining two axis of motion; Lastly, I will fit various acceleration models base on my intuition, calculus, and even the switching to polar coordinates.

% straight line
\subsection{Key idea and boundary condition}
The key idea that will be repeated throughout this analysis is the extend that maximizing the player velocity will maximize the displacement. I hypothesized this from the position differential equations in Eq. \ref{eq:1de2}, that under the assumption of constant velocity, the final displacement will be proportional to that constant:
\begin{align*}
    \tp'(t) &= \tv(t)\\
    \tp(t) &= \int \tv(t) \, dt\\
    &= t(\tv(t)) + \tp(0) = t(\tv(t)) + \tvec{0},\\
    \tp &\propto \tv(t).
\end{align*}

Therefore, I was able to set an optimal initial velocity for the player, also known as the boundary condition of the problem. For we are maximizing the jump displacement, and higher velocity equates to higher displacement, it is reasonable to set the initial velocity as high as possible. So
\[
    \tmag{\tv} = 250,
\]
where $250$ is the player's fastest ground running speed.


\begin{figure}[H]
    \centering
    \begin{minipage}{.5\textwidth}
        \centering
        \includegraphics[width=0.9\linewidth]{assets/1coordinates.png}
        \caption{The coordinate system}
        \label{fig:1coordinates}
    \end{minipage}%
    \begin{minipage}{.5\textwidth}
        \centering
        \includegraphics[width=0.9\linewidth]{assets/2coordinate_topdown.png}
        \caption{The top down view}
        \label{fig:2coordinates_topdown}
    \end{minipage}
\end{figure}


Furthermore, it should be noted that the problem is rotationally invariant when viewed top down. Let the z-axis denote the vertical height of the player, and the x,y-axis to be the plane displacement from a top down view (see figure \ref{fig:1coordinates}, figure \ref{fig:2coordinates_topdown}). \begin{wrapfigure}{r}{0.40\textwidth}
    \includegraphics[width=0.37\textwidth,right]{assets/2turning.png}
    \caption{Rotational Invariant (the player wishes to go rightwards)}
    \label{fig:2turning}
\end{wrapfigure}
By considering only the x,y-axis --- and the z-axis remaining constant before and after the jump --- I realized that an optimal strategy does not depend on the angle of the initial velocity vector within the plane, for unless we somehow ended up behind our initial direction, it is always possible to rotate the initial velocity such that we travel in a desired direction of displacement (see figure \ref{fig:2turning}). This meant that the optimal initial velocity is not restricted to a certain direction, but for the sake of consistency between models, I shall use the initial velocity pointing in the y-axis:
\[
    \tv = \tang{0, 250, 0}.
\]

\subsection{Straight Line}

\begin{wrapfigure}{r}{0.40\textwidth}
    \includegraphics[width=0.37\textwidth,right]{assets/2straightjumping.png}
    \caption{Straight Jumping}
    \label{fig:2straightjumping}
\end{wrapfigure}
With the key idea and boundary condition in mind, I attempted a straight line model. This model has the player accelerate and move in a straight line, for mathematics has taught me that the shortest distance between two points comes from a line, resulting in less time needed to travel a long distance, which is helpful in optimizing displacement over time. To achieve this, the player would need to accelerate along the y-axis, for that is in the direction of its initial velocity, which maximizes speed at all times, and would theoretically result in the largest displacement. Mathematically, this is equivalent, to setting the directional vector to
\[
    \td(t) = \tang{0, 1, 0}
\]
for all time $t$. Realistically, this will be equivalent to pressing down ``w'' and not moving the mouse.
% do model!!

To test this model, I recorded myself jumping and doing the actions described above --- it is important that the x,z-axis should not be changed after the jump; it is only the y-axis that I am recording. Figure \ref{fig:2straightjumping} shows the coordinates of the player at the start of the jump $\tp(0)$, the first discrete time of the jump $\tp(\tau)$, and the end of the jump $\tp(t_f)$ --- the symbol $t_f$ denotes the duration of the jump. Here are them written inline:
\begin{align}
 \tp(0) &= \tang{1702.63, 725.59, 128.03}, \quad \tmag{\tv(0)} = 250.00 \label{eq:2emp0}\\
 \tp(\tau) &= \tang{1702.63, 721.27, 130.83}, \quad \tmag{\tv(\tau)} = 378.35 \label{eq:2emp1}\\
 \tp(t_f) &= \tang{1702.65,541.95, 132.94}, \quad \tmag{\tv(t_f)} = 250.00 \label{eq:2emp2}.
\end{align}

\subsubsection{Analysis}
Using the simple empirical data in Eq. \ref{eq:2emp0}, Eq. \ref{eq:2emp1}, and Eq. \ref{eq:2emp2}, not only can I analyze the straight line model, but I can also calculate the various fundamental constants within the problem --- such as impulse and acceleration. However, I've also noticed that the x,z-axis has changed after the jump. The x change is likely the result of my uncertainty in having an initial velocity directly in the y-axis, but due to the rotational invariant discussed before, this is a non detrimental problem; but the z-axis is different and is likely to be the result of some ``bounciness'' of the player as it hits the floor --- which doesn't matter in the optimizing of displacement. Thus, I chose to ignore only the z-axis change during calculations.

The total displacement of this jump par definition is the expression $d = \tmag{\tp(t_f) - \tp(0)}$, which is
\begin{align*}
    d &= \sqrt{(\tp(t_f)_x - \tp(0)_x)^2 + (\tp(t_f)_y - \tp(0)_y)^2 + (\tp(t_f)_z - \tp(0)_z)^2}\\
    &= \sqrt{(1702.65-1702.63)^2 + (541.95-725.59)^2 + (0)^2}\\
    &\approx 183.64.
\end{align*}


Firstly notice the sudden change in the velocity of the player at in first frame, time $\tau$. From this I deduced that the act of jumping is achieved by an impulse --- a sudden change in velocity --- upon the z-axis. With the assumption that no such impulses occurs in the x,y-axis, we can find the vertical change in velocity of the player at the start of the jump using the Pythagorean Theorem (figure \ref{fig:2verticalimpulse}):
\begin{wrapfigure}{r}{0.40\textwidth}
    \includegraphics[width=0.37\textwidth,right]{assets/2verticalimpulse.png}
    \caption{Jumping impulses}
    \label{fig:2verticalimpulse}
\end{wrapfigure}
\begin{align*}
    \tmag{\tv}^2 &= \tv_y^2 + \tv_z^2\\
    \tv_z &= \sqrt{\tmag{\tv}^2 - \tv_y^2}\\
    &= \sqrt{378.35^2 -250^2}\\
    &= 284.00.
\end{align*}

With approximations in continuous time, we can set the player's initial vertical velocity to this number such that
\[
    \tv_{z0} = 284.
\]


Secondly, by measuring the duration of the jump --- which I've done by counting the number of video frames of a sixty hertz video, or $44 \times \frac{1}{60} = 0.7333 \si{s}$ --- I was able to derive the average speed $\tv_{a}$ of the player:
\[
    \tv_{a} = \frac{183.71}{0.7333} \approx 250.42.
\]

Isn't that surprising? Turns out that there is almost zero net acceleration in the straight line model --- the average velocity does not differ from its initial value --- which meant that the acceleration as a function of time $t$ and wishing direction $\td(t)$ is zero:
\[
    \ta(t, \td) = \tang{0, 0, 0}.
\]

I suspect a speed limit is in play here. This is bad in the optimization of jump displacement as it restricts the player's velocity, which by the key idea, is likely to limit the displacement too. But the game certainty cannot be limiting the magnitude of velocity directly as I've achieved higher velocity while playing, often subconsciously. My research in the engine source code \parencite{valvesoftware} and a simplified article about the mechanics in a similar game called ``Half Life'' \parencite{jwchong} was targeting exactly this mechanic of velocity limiting. In short, the player's velocity $\tv$ is limited by its projection onto the wished direction $\td$.

\subsubsection{Speed limit and Continuous modeling}
\begin{wrapfigure}{r}{0.40\textwidth}
    \includegraphics[width=0.37\textwidth,right]{assets/2proj.png}
    \caption{Projection limiting}
    \label{fig:2proj}
\end{wrapfigure}
A vector's projection onto another is another way to say how much the vector is pointing in the direction of another, in the form of a number. Denoted by $\text{proj}(\tv, \td)$, the projection is the side of the triangle along the direction of $\td$ form by a perpendicular line from $\tv$ to $\td$ (figure \ref{fig:2proj}). This can be defined using dot products by the following identity (APPENDIX proof):
\[
    \text{proj}(\tv, \td) = \frac{\tv \cdot \td}{\tmag{\td}}.
\]

Additionally, the game engine states that the vector $\td$ never has a z-component and is a unit vector, meaning that its magnitude is zero. Therefore the projection is simply the 2D vector dot product between $\tv$ and $\td$.
\begin{align*}
    \text{proj}(\tv, \td) &= \tv \cdot \td\\
    &= \tv_x \td_x + \tv_y \td_y + \tv_z \td_z\\
    &= \tv_x \td_x + \tv_y \td_y.
\end{align*}

Lastly, the game engine computes the player acceleration by checking if this projection excesses a limit $L$, set to $250$. If it does, acceleration will be zero; else, acceleration is a constant $K$ in the direction of $\td$, equal to $LA\tau$ each frame, and in the continuous sense is $LA$ --- where $A$ is a multiplier equal to $10$. The player's acceleration function can therefore be defined piecewisely as:
\begin{figure}[H]
    \centering
    \[
        \ta(t) = \begin{cases}
            LA \td & \text{proj}(\tv, \td) \ge L\\
            0 & \text{otherwise}
        \end{cases}
    \]
    \label{eq:playeracceleration}
    \caption{Player acceleration function}
\end{figure}

In the case of maximizing displacement, we ideally want the first condition of equation \ref{eq:playeracceleration} to be true for as long as possible. Yet in the context of my straight line model, it is simple to see that the first condition is never true, for
\begin{align*}
    \text{proj}(\tv, \td) &= \tv_x \td_x + \tv_y \td_y\\
    &= \tv_x \times 0 + \tv_y \times 1\\
    &= \tv_y,\\
    \text{and because} \quad \tv_{y0} &= 250 = L\\
    \text{proj}(\tv, \td) &= L\\
    \text{and} \quad \ta(t) &= 0.
\end{align*}
Our acceleration model has therefore confirmed our hypothesis that the player is not accelerating at all. This makes the model a terrible one for maximizing one's jumping displacement, as low acceleration equals to lower velocity, and in turn decreases displacement per my key idea.

But before I try some other models, let's first evaluate the continuous approximation using this simplistic model.






% should we first talk about modeling constants or this mechanic?









%% 44 frames
% discuss vertical axis

% evantually my best, and as a model

% try it



%\input{sections/vertical.tex}
%\newpage
%\input{sections/jumping.tex}
%\newpage
\input{sections/models.tex}
%\newpage
\input{sections/conclusion.tex}

\nocite{*}
\newpage
\printbibliography

\end{document}
